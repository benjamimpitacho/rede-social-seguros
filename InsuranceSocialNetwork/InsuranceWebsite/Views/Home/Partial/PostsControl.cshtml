@using InsuranceSocialNetworkDTO.Post;
@using InsuranceSocialNetworkBusiness
@using InsuranceSocialNetworkCore.Enums;
@model InsuranceWebsite.Models.PostItemsViewModel

@Html.HiddenFor(m => m.Items)
@Html.HiddenFor(m => m.Profile)

@*<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">*@
@*<link href="~/Content/bookpost/css/jquery-ui.css" rel="stylesheet" />*@
<script type="text/javascript" src="~/Scripts/jquery.expander.js"></script>
<script src="~/Scripts/linkItUp.js"></script>

<style>
    .ui-dialog {
        z-index: 1000 !important;
    }

    .ui-front {
        z-index: 1000 !important;
    }

    .ui-widget-overlay {
        z-index: 999 !important;
        opacity: 0.3;
    }

    .ui-dialog-titlebar {
        display: none;
    }
</style>

<div>
    @foreach (PostDTO post in Model.Items)
    {
        <div class="panel panel-white post panel-shadow">

            <div class="post-heading post">

                <div class="pull-left image" style="padding:5px">
                    @if (post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.GLOBAL_POST.ToString()
                        || post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.NEWS_POST.ToString()
                        || post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.SPONSORED_POST.ToString())
                    {
                        <img src="~/Content/logos/cinza_simbolo_falar_seguros_2.png" class="avatar" alt="user profile image">
                    }
                    else
                    {
                        if (!InsuranceBusiness.BusinessLayer.IsUserInRoleByUsername(this.User.Identity.Name, RoleEnum.PORTAL_COMMERCIAL.ToString()))
                        {
                            <a href="@Url.Action("ProfileInfo", "Home", new { id = post.PostOwner.ID })">
                        
                            
                                @if (null != post.PostOwner.ProfilePhoto && post.PostOwner.ProfilePhoto.Length > 0)
                                {
                                    <img src="@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(post.PostOwner.ProfilePhoto))" class="avatar" alt="user profile image">
                                }
                                else
                                {
                                    <img src="~/Content/images/no_photo_img.jpg" class="avatar" alt="user profile image">
                                }
                            </a>
                        }
                        else
                        {
                            if (null != post.PostOwner.ProfilePhoto && post.PostOwner.ProfilePhoto.Length > 0)
                            {
                                <img src="@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(post.PostOwner.ProfilePhoto))" class="avatar" alt="user profile image">
                            }
                            else
                            {
                                <img src="~/Content/images/no_photo_img.jpg" class="avatar" alt="user profile image">
                            }
                        }
                    }
                </div>

                <div class="pull-left meta" style="margin-bottom: 0px;">

                    <div class="h5" style="font-weight: bold;">
                        @if (!post.IsRepost 
                            && (
                                post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.GLOBAL_POST.ToString()
                                || post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.NEWS_POST.ToString()
                                || post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.SPONSORED_POST.ToString()
                            ))
                        {
                            <span class="post-user-name" style="color:#00C1DE;">@Resources.Resources.FalarSeguros</span>
                        }
                        else
                        {
                            <a href="@Url.Action("ProfileInfo", "Home", new { id = post.PostOwner.ID })" class="post-user-name">@post.PostOwner.FirstName</a>
                        }
                        
                        @if (post.IsRepost)
                        {
                            if (post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.GLOBAL_POST.ToString()
                                || post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.NEWS_POST.ToString()
                                || post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.SPONSORED_POST.ToString())
                            {
                                <span style="font-weight:normal;color:#939DA3;"> @string.Format(Resources.Resources.SharedPostOf, "") <span style="font-weight:bold;color:#00C1DE;">@Resources.Resources.FalarSeguros</span></span>
                            }
                            else
                            {
                                <span style="font-weight:normal;color:#939DA3;"> @string.Format(Resources.Resources.SharedPostOf, "") <span style="font-weight:bold;">@post.PostOwner.FirstName</span></span>
                            }
                        }

                    </div>

                    @if (post.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.SPONSORED_POST.ToString())
                    {
                        <h6 class="text-muted time">@Resources.Resources.Sponsored.ToUpper()</h6>
                    }
                    else
                    {
                        if (DateTime.Now.Subtract(post.CreateDate).TotalMinutes < 1)
                        {
                            <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.CreateDate).TotalSeconds, 0) @Resources.Resources.SecondsAgo</h6>
                        }
                        else if (DateTime.Now.Subtract(post.CreateDate).TotalHours < 2)
                        {
                            <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.CreateDate).TotalMinutes, 0) @Resources.Resources.MinutesAgo</h6>
                        }
                        else if (DateTime.Now.Subtract(post.CreateDate).TotalDays < 1)
                        {
                            <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.CreateDate).TotalHours, 0) @Resources.Resources.HoursAgo</h6>
                        }
                        else if (DateTime.Now.Subtract(post.CreateDate).TotalDays == 1)
                        {
                            <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.CreateDate).TotalDays, 0) @Resources.Resources.DayAgo</h6>
                        }
                        else if (DateTime.Now.Subtract(post.CreateDate).TotalDays < 3)
                        {
                            <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.CreateDate).TotalDays, 0) @Resources.Resources.DaysAgo</h6>
                        }
                        else
                        {
                            <h6 class="text-muted time">@post.CreateDate.ToShortDateString()</h6>
                        }
                    }

                </div>

                <div class="pull-right">
                    @if (post.ID_User == Model.Profile.ID_User || InsuranceSocialNetworkBusiness.InsuranceBusiness.BusinessLayer.IsUserInRoleByUsername(Model.Profile.User.UserName, RoleEnum.ADMINISTRATOR.ToString()))
                    {
                        <i class="glyphicon glyphicon-option-vertical icon context-menu-one" id="menu_@post.ID" style="border:0px;font-size: 24px;margin-right: 10px;" title="@Resources.Resources.Settings"></i>
                    }
                    else
                    {
                        <i class="glyphicon glyphicon-option-vertical icon context-menu-two" id="menu_@post.ID" style="border:0px;font-size: 24px;margin-right: 10px;" title="@Resources.Resources.Settings"></i>
                    }
                </div>

            </div>

            <div class="post-description" style="word-break:break-all; text-align:justify;">

                @if (post.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.FILE_POST.ToString())
                {
                    <a id="file_@post.ID" href="@Url.Action("Download", "Home", new { id = post.ID })">
                        <i class="fa fa-file-text-o" aria-hidden="true" style="font-size:30px;padding-left: 15px;padding-right:10px;"></i>
                    </a>
                }
                <span id="text_@post.ID">@post.Text</span>

            </div>

            @*Reported Post Details*@
            @if (post.IsRepost @*&& post.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.TEXT_POST.ToString()*@ && null != post.Post2)
            {
                @*<a href="@Url.Action("PostDetail", "Home", new { idPost = post.Post2.ID})">*@
                    <div class="panel panel-white post panel-shadow" style="border: 0px #ccc solid;">

                        @*<div class="post-heading">

                            <div class="pull-left image" style="padding:5px">
                                @if (null != post.Post2.PostOwner.ProfilePhoto && post.Post2.PostOwner.ProfilePhoto.Length > 0)
                                {
                                    <img src="@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(post.Post2.PostOwner.ProfilePhoto))" class="avatar" alt="user profile image">
                                }
                                else
                                {
                                    <img src="~/Content/images/no_photo_img.jpg" class="avatar" alt="user profile image">
                                }
                            </div>

                            <div class="pull-left meta" style="margin-bottom: 0px;">

                                <div class="h5" style="font-weight: bold;">

                                    @if (post.Post2.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.GLOBAL_POST.ToString()
                                        || post.Post2.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.NEWS_POST.ToString()
                                        || post.Post2.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.SPONSORED_POST.ToString()
                                    )
                                    {
                                        @Resources.Resources.FalarSeguros
                                    }
                                    else
                                    {
                                        @post.Post2.PostOwner.FirstName
                                    }

                                </div>

                                @if (post.Post2.PostSubject.Token == InsuranceSocialNetworkCore.Enums.PostSubjectEnum.SPONSORED_POST.ToString())
                                {
                                    <h6 class="text-muted time">@Resources.Resources.Sponsored.ToUpper()</h6>
                                }
                                else
                                {
                                    if (DateTime.Now.Subtract(post.Post2.CreateDate).TotalMinutes < 1)
                                    {
                                <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.Post2.CreateDate).TotalSeconds, 0) @Resources.Resources.SecondsAgo</h6>
                                    }
                                    else if (DateTime.Now.Subtract(post.Post2.CreateDate).TotalHours < 2)
                                    {
                                <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.Post2.CreateDate).TotalMinutes, 0) @Resources.Resources.MinutesAgo</h6>
                                    }
                                    else if (DateTime.Now.Subtract(post.Post2.CreateDate).TotalDays < 1)
                                    {
                                <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.Post2.CreateDate).TotalHours, 0) @Resources.Resources.HoursAgo</h6>
                                    }
                                    else if (DateTime.Now.Subtract(post.Post2.CreateDate).TotalDays == 1)
                                    {
                                <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.Post2.CreateDate).TotalDays, 0) @Resources.Resources.DayAgo</h6>
                                    }
                                    else if (DateTime.Now.Subtract(post.Post2.CreateDate).TotalDays < 3)
                                    {
                                <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(post.Post2.CreateDate).TotalDays, 0) @Resources.Resources.DaysAgo</h6>
                                    }
                                    else
                                    {
                                <h6 class="text-muted time">@post.Post2.CreateDate.ToShortDateString()</h6>
                                    }
                                }

                            </div>
                        </div>*@

                        <div class="post-description" style="word-break:break-all; text-align:justify;">

                            @if (post.Post2.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.FILE_POST.ToString())
                            {
                            @*<a id="file_@post.Post2.ID" href="@Url.Action("Download", "Home", new { id = post.Post2.ID })">*@<i class="fa fa-file-text-o" aria-hidden="true" style="font-size:30px;padding-left: 15px;padding-right:10px;"></i>@*</a>*@
                            }
                            <span id="text_@post.Post2.ID">@post.Post2.Text</span>

                        </div>

                        @if (post.Post2.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.IMAGE_POST.ToString())
                    {

                        <div class="post-image">

                            @*<img src="@post.Post2.ImageSource" class="image show-in-modal" alt="image post">*@

                            <div id="gallery_@post.Post2.ID" class="image show-in-modal"></div>

                            <script>

                            $(function () {

                                $('#gallery_'+@post.Post2.ID).imagesGrid({
                                    images: [
                                        {
                                            src: '@post.Post2.ImageSource'
                                        }
                                    ],
                                    align: true,
                                    getViewAllText: function (imgsCount) { return 'View all' }
                                });

                            });

                            </script>

                        </div>
                        }

                        @if (post.Post2.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.LINK_POST.ToString())
                    {

                        <div id="">
                            <div style="padding:10px;">
                                @*<a href="@post.Post2.URL" target="_blank">*@
                                <div style="border: 1px #ccc solid;">
                                    @if (!string.IsNullOrEmpty(post.Post2.ImageSource))
                                    {
                                        <div class="linkPostImageSection" data-url="/home/getpostimage/@post.ID">
                                            <div style="text-align:center">
                                                <img src="~/Content/images/waiting.gif" />
                                            </div>
                                            @*<div style="text-align:center;"><img src="@String.Format("data:{0};base64,{1}", post.PostImage[0].Type, Convert.ToBase64String(post.PostImage[0].Image))" class="image" alt="image post"></div>*@
                                            @*<div style="text-align:center;"><img src="@post.ImageSource" class="image" alt="image post"></div>*@
                                        </div>
                                    }
                                    @if (!string.IsNullOrEmpty(post.Post2.URL_Title) || !string.IsNullOrEmpty(post.Post2.URL_Description) || !string.IsNullOrEmpty(post.Post2.URL_Domain))
                                        {
                                        <div style="border-top: 1px #ccc solid;padding: 10px;">
                                            <div style="font-weight: bold;font-size: 16px;color:#333;">@Html.Raw(post.Post2.URL_Title)</div>
                                            <div style="font-size: 12px;">@Html.Raw(post.Post2.URL_Description)</div>
                                            <div>
                                                <div>
                                                    <div style="color: #6F7D85;">@post.Post2.URL_Domain</div>
                                                    <div class=""></div>
                                                </div>
                                            </div>
                                        </div>
                                        }
                                </div>
                                @*</a>*@
                            </div>
                        </div>
                        }
                    </div>
                @*</a>*@
            }
            else if (post.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.IMAGE_POST.ToString())
            {

                <div class="post-image">

                    @*<img src="@post.ImageSource" class="image show-in-modal" alt="image post">*@

                    <div id="gallery_@post.ID" class="image show-in-modal"></div>

                    <script>

                        $(function () {

                            $('#gallery_'+@post.ID).imagesGrid({
                                images: [
                                    {
                                        src: '@post.ImageSource'
                                    }
                                ],
                                align: true,
                                getViewAllText: function (imgsCount) { return 'View all' }
                            });

                        });

                    </script>

                </div>
            }
            else if (post.PostType.Token == InsuranceSocialNetworkCore.Enums.PostTypeEnum.LINK_POST.ToString())
            {

                <div id="livePreviewBox">
                    <div style="padding:10px;">
                        <a href="@post.URL" target="_blank">
                            <div style="border: 1px #ccc solid;">
                                @if (!string.IsNullOrEmpty(post.ImageSource))
                                {
                                    <div class="linkPostImageSection" data-url="/home/getpostimage/@post.ID">
                                        <div style="text-align:center">
                                            <img src="~/Content/images/waiting.gif" />
                                        </div>
                                        @*<div style="text-align:center;"><img src="@String.Format("data:{0};base64,{1}", post.PostImage[0].Type, Convert.ToBase64String(post.PostImage[0].Image))" class="image" alt="image post"></div>*@
                                        @*<div style="text-align:center;"><img src="@post.ImageSource" class="image" alt="image post"></div>*@
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(post.URL_Title) || !string.IsNullOrEmpty(post.URL_Description) || !string.IsNullOrEmpty(post.URL_Domain))
                                {
                                    <div style="border-top: 1px #ccc solid;padding: 10px;">
                                        <div style="font-weight: bold;font-size: 16px;color:#333;">@Html.Raw(post.URL_Title)</div>
                                        <div style="font-size: 12px;">@Html.Raw(post.URL_Description)</div>
                                        <div>
                                            <div>
                                                <div style="color: #6F7D85;">@post.URL_Domain</div>
                                                <div class=""></div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </a>
                    </div>
                </div>
            }

            @if (!InsuranceBusiness.BusinessLayer.IsUserInRoleByUsername(this.User.Identity.Name, RoleEnum.PORTAL_COMMERCIAL.ToString()))
            {
                <div class="post-description" style="border-top: 1px solid #eee;">

                    <div class="stats">

                        @if (null != post.PostLike && post.PostLike.Count > 0 && post.PostLike.Exists(i => i.ID_User == Model.Profile.ID_User))
                        {
                            <a onclick="UnlikePost(this, @post.ID, @post.PostLike.Count)" class="stat-item" id="unlikePost" style="color:#00C1DE;min-width: 50px;" title="@Resources.Resources.Unlike">
                                <img class="post-icon" src="~/Content/icons/icons_diretorios_rede_social_falar_seguros_AF3.png" /><span style="padding-left: 8px;color:#4B5C66;font-size: 10px;">@post.PostLike.Count</span>
                            </a>
                        }
                        else if (null != post.PostLike && post.PostLike.Count > 0)
                        {
                            <a onclick="LikePost(this, @post.ID, @post.PostLike.Count)" class="stat-item" id="likePost" style="min-width: 50px;" title="@Resources.Resources.Like">
                                <img class="post-icon" src="~/Content/icons/icons_diretorios_rede_social_falar_seguros_AF2.png" /><span style="padding-left: 8px;color:#4B5C66;font-size: 10px;">@post.PostLike.Count</span>
                            </a>
                        }
                        else
                        {
                            <a onclick="LikePost(this, @post.ID, @post.PostLike.Count)" class="stat-item" style="min-width: 50px;" title="@Resources.Resources.Like">
                                <img class="post-icon" src="~/Content/icons/icons_diretorios_rede_social_falar_seguros_AF2.png" />
                            </a>
                        }

                        <a class="stat-item" style="min-width: 50px;" title="@Resources.Resources.Comments">
                            <img class="post-icon" src="~/Content/icons/home_page_rede_social_falar_seguros_AF14.png" />
                            @if (post.PostComment.Count > 0)
                            {
                                <span style="padding-left: 8px;color:#4B5C66;font-size: 10px;">
                                    @post.PostComment.Count
                                </span>
                            }
                        </a>

                        <a id="sharePostButton" onclick="SharePost(@post.ID)" class="stat-item" style="min-width: 50px;" title="@Resources.Resources.Share">
                            <img class="post-icon" src="~/Content/icons/icons_perfil_rede_social_falar_seguros_v27.png" />
                        </a>

                    </div>

                </div>

                <div class="post-footer" style="border-top: 1px solid #eee;">

                    @if (null != post.PostComment && post.PostComment.Count > 0)
                    {
                        <ul class="comments-list">

                            @foreach (PostCommentDTO comment in post.PostComment)
                            {
                                <li class="comment">

                                    <a class="pull-left" href="@Url.Action("ProfileInfo", "Home", new { id = comment.CommentOwner.ID })">

                                        @if (null != comment.CommentOwner.ProfilePhoto && comment.CommentOwner.ProfilePhoto.Length > 0)
                                        {
                                            <img src="@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(comment.CommentOwner.ProfilePhoto))" class="avatar" alt="user profile image">
                                        }
                                        else
                                        {
                                            <img src="~/Content/images/no_photo_img.jpg" class="avatar" alt="user profile image">
                                        }

                                    </a>

                                    <div class="comment-body" style="font-size:12px">

                                        <h6 class="comment-user-name"><a href="@Url.Action("ProfileInfo", "Home", new { id = comment.CommentOwner.ID })">@comment.CommentOwner.FirstName</a></h6> <span>@comment.Text</span>

                                        <div class="comment-heading">

                                            @if (DateTime.Now.Subtract(comment.Date).TotalMinutes < 1)
                                            {
                                                <h6 class="time">@Math.Round(DateTime.Now.Subtract(comment.Date).TotalSeconds, 0) @Resources.Resources.SecondsAgo</h6>
                                            }
                                            else if (DateTime.Now.Subtract(comment.Date).TotalHours < 1)
                                            {
                                                <h6 class="time">@Math.Round(DateTime.Now.Subtract(comment.Date).TotalMinutes, 0) @Resources.Resources.MinutesAgo</h6>
                                            }
                                            else if (DateTime.Now.Subtract(comment.Date).TotalDays < 1)
                                            {
                                                <h6 class="time">@Math.Round(DateTime.Now.Subtract(comment.Date).TotalHours, 0) @Resources.Resources.HoursAgo</h6>
                                            }
                                            else if (DateTime.Now.Subtract(comment.Date).TotalDays == 1)
                                            {
                                                <h6 class="text-muted time">@Math.Round(DateTime.Now.Subtract(comment.Date).TotalDays, 0) @Resources.Resources.DayAgo</h6>
                                            }
                                            else if (DateTime.Now.Subtract(comment.Date).TotalDays < 3)
                                            {
                                                <h6 class="time">@Math.Round(DateTime.Now.Subtract(comment.Date).TotalDays, 0) @Resources.Resources.DaysAgo</h6>
                                            }
                                            else
                                            {
                                                <h6 class="time">@comment.Date.ToShortDateString()</h6>
                                            }

                                        </div>
                                    </div>

                                </li>
                            }

                        </ul>
                    }

                    @using (Html.BeginForm("NewComment", "Home", FormMethod.Post, new { @class = "commentForm" }))
                    {
                        <input type="hidden" id="postId" name="postId" value="@post.ID" />
                                <input id="postNewComment" name="postNewComment" class="form-control add-comment-input" placeholder="@Resources.Resources.AddComment" type="text" />
                    }
                </div>
            }

        </div>
    }
</div>

<div id="dialog-confirm-delete" style="display: none"></div>
<div id="dialog-confirm-hide" style="display: none"></div>
<div id="dialog-confirm-report" style="display: none"></div>
<div id="dialog-confirm-edit" style="display:none;height:auto;"></div>
<div id="dialog-confirm-repost" style="display:none;height:auto;"></div>

<script type="text/javascript">
    var url = "";
    var postId = 0;

    function SharePost(id)
    {
        postId = id;
        $("#dialog-confirm-repost").dialog('open');
    }

    $(function () {

        $(".comment-body").linkify({ target: "_blank" });

        $('.post-description').expander({
            slicePoint: 500,
            expandText: '@Resources.Resources.ReadMore',
            userCollapseText: '@Resources.Resources.ReadLess'
        });

        $(".commentForm").on("submit", function(e) {
            e.preventDefault();  //prevent form from submitting

            if($(e.target).parent().children(".comments-list").length == 0)
            {
                //alert("nao ha comments list");
                $(e.target).parent().prepend("<ul class=\"comments-list\"></ul>");
            }

            $(e.target).parent().children(".comments-list").append("<li class=\"comment\"><a class=\"pull-left\" href=\"/Home/ProfileInfo/@Model.Profile.ID\"><img src=\"@String.Format("data:image/png;base64,{0}", Convert.ToBase64String(Model.Profile.ProfilePhoto))\" class=\"avatar\" ></a><div class=\"comment-body\" style=\"font-size:12px\"><h6 class=\"comment-user-name\"><a href=\"/Home/ProfileInfo/1\">Administrator</a></h6> " + $(e.target).children("#postNewComment").val() + "<div class=\"comment-heading\"><h6 class=\"time\">@Resources.Resources.Now</h6></div></div></li>");
            jQuery.post('@Url.Action("NewComment", "Home")',
                { postId: $(e.target).children("#postId").val(), postNewComment: $(e.target).children("#postNewComment").val(), hasNotification: true }
            )
            .done(function (data) {
                //alert("retorno do comment:" + data);
            })
            .fail(function () {
                //alert("falhou...");
            });

            $(e.target).children("#postNewComment").val("");

        });

        $(".linkPostImageSection").each(function (index, item) {
            var url = site.baseUrl + $(item).data("url");
            if (url && url.length > 0) {
                $(item).load(url);
            }
        });

        //$("#sharePostButton").click(function (e) {
        //    $("#dialog-confirm-repost").dialog('open');
        //});

        $.contextMenu({
            selector: '.context-menu-one',
            callback: function (key, options) {
                //var m = "clicked: " + key;
                //window.console && console.log(m) || alert(m);
                postId = options.$trigger.attr("id").replace("menu_", "");
                switch (key)
                {
                    case "hide":
                        $("#dialog-confirm-hide").dialog('open');
                        break;
                    case "edit":
                        $("#dialog-confirm-edit").dialog('open');
                        break;
                    case "delete":
                        $("#dialog-confirm-delete").dialog('open');
                        break;
                    default: break;
                }
            },
            items: {
                "edit": { name: "@Resources.Resources.Edit", icon: "" },
                "hide": { name: "@Resources.Resources.Hide", icon: "" },
                "sep1": "---------",
                "delete": { name: "@Resources.Resources.Delete", icon: "" }
            }
        });

        $.contextMenu({
            selector: '.context-menu-two',
            callback: function (key, options) {
                postId = options.$trigger.attr("id").replace("menu_", "");
                switch (key)
                {
                    case "hide":
                        @*url = "@Url.Action("HidePost", "Home")" + "/" + postId;*@
                        $("#dialog-confirm-hide").dialog('open');
                        break;
                    case "report":
                        @*url = "@Url.Action("HidePost", "Home")" + "/" + postId;*@
                        $("#dialog-confirm-report").dialog('open');
                        break;
                    default: break;
                }
            },
            items: {
                @*"edit": { name: "@Resources.Resources.Edit", icon: "edit" },*@
                "hide": { name: "@Resources.Resources.Hide", icon: "" },
                "report": { name: "@Resources.Resources.Report", icon: "" }
                //"sep1": "---------",
                @*"delete": { name: "@Resources.Resources.Delete", icon: "delete" }*@
            }
        });

        $('.context-menu-one').on('click', function (e) {
            console.log('clicked', this);
        });

        $('.context-menu-two').on('click', function (e) {
            console.log('clicked', this);
        });

        $("#dialog-confirm-delete").dialog({
            title: '@Resources.Resources.Delete',
            autoOpen: false,
            resizable: false,
            width: 400,
            height: 200,
            show: { effect: 'drop', direction: "up" },
            modal: true,
            draggable: true,
            position: { my: "center", at: "center", of: window },
            open: function (e, ui) {
                $(this).load("@Url.Action("ConfirmPostDelete", "Home")" + "/" + postId);
            },
            buttons: {}
        });

        $("#dialog-confirm-hide").dialog({
            title: '@Resources.Resources.Hide',
            autoOpen: false,
            resizable: false,
            width: 400,
            height: 200,
            show: { effect: 'drop', direction: "up" },
            modal: true,
            draggable: true,
            position: { my: "center", at: "center", of: window },
            open: function (event, ui) {
                $(this).load("@Url.Action("ConfirmPostHide", "Home")" + "/" + postId);
            },
            buttons: {}
        });

        $("#dialog-confirm-report").dialog({
            title: '@Resources.Resources.Report',
            autoOpen: false,
            resizable: false,
            width: 400,
            height: 200,
            show: { effect: 'drop', direction: "up" },
            modal: true,
            draggable: true,
            position: { my: "center", at: "center", of: window },
            open: function (event, ui) {
                $(this).load("@Url.Action("ConfirmPostReport", "Home")" + "/" + postId);
            },
            buttons: {}
        });

        $("#dialog-confirm-edit").dialog({
            title: '@Resources.Resources.Edit',
            autoOpen: false,
            resizable: false,
            height: 550,
            width: 450,
            show: { effect: 'drop', direction: "up" },
            modal: true,
            draggable: true,
            position: { my: "center", at: "center", of: window },
            open: function (event, ui) {
                $(this).load("@Url.Action("EditPostDialog", "Home")" + "/" + postId);
            }
        });

        $("#dialog-confirm-repost").dialog({
            title: '@Resources.Resources.Publish',
            autoOpen: false,
            resizable: false,
            height: 550,
            width: 450,
            show: { effect: 'drop', direction: "up" },
            modal: true,
            draggable: true,
            position: { my: "center", at: "center", of: window },
            open: function (event, ui) {
                $(this).load("@Url.Action("SharePostDialog", "Home")" + "/" + postId);
            },
            buttons: {}
        });
    });

    function LikePost(object, postId, likesCount) {
        object.style.color = "#00C1DE";
        object.innerHTML = "<img class=\"post-icon\" src=\"/Content/icons/icons_diretorios_rede_social_falar_seguros_AF3.png\" /><span style=\"padding-left: 8px;color:#4B5C66;font-size: 10px;\">" + (likesCount+1) + "</span>";
        likesCount = likesCount + 1;
        object.onclick = function() { UnlikePost(object, postId, likesCount); }

        jQuery.post('@Url.Action("LikePost", "Home")',
                { postId: postId }
            )
            .done(function (data) {
            })
            .fail(function () {
            });
    }

    function UnlikePost(object, postId, likesCount) {
        object.style.color = "#7f7f7f";
        if(likesCount <= 1)
        {
            object.innerHTML = "<img class=\"post-icon\" src=\"/Content/icons/icons_diretorios_rede_social_falar_seguros_AF2.png\" />";
        }
        else
        {
            object.innerHTML = "<img class=\"post-icon\" src=\"/Content/icons/icons_diretorios_rede_social_falar_seguros_AF2.png\" /><span style=\"padding-left: 8px;color:#4B5C66;font-size: 10px;\">" + (likesCount-1) + "</span>";
        }
        if(likesCount > 0)
        {
            likesCount = likesCount - 1;
        }
        object.onclick = function() { LikePost(object, postId, likesCount); }

        jQuery.post('@Url.Action("UnlikePost", "Home")',
                { postId: postId }
            )
            .done(function (data) {
            })
            .fail(function () {
            });
    }

</script>
